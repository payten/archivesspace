<%
  indent_level = @result.raw.fetch('ancestors', []).length
%>
<div class="infinite-item infinite-item-indent-<%= indent_level %>">

  <div class="context" style="display: none">
    <ul>
      <% if @result.is_a?(ArchivalObject) %>
        <% @result.ancestors.each do |ancestor| %>
          <% parsed_uri = JSONModel.parse_reference(ancestor['uri']) %>
          <li><%= link_to ancestor['title'].html_safe, "#tree::#{parsed_uri[:type]}_#{parsed_uri[:id]}", :"data-uri" => ancestor['uri'] %></li>
        <% end %>
      <% end %>
      <% parsed_uri = JSONModel.parse_reference(@result['uri']) %>
      <li><%= link_to @result['title'].html_safe, "#tree::#{parsed_uri[:type]}_#{parsed_uri[:id]}", :"data-uri" => @result['uri'] %></li>
    </ul>
  </div>

  <div class="information" style="overflow: hidden;">
      <%= render partial: 'shared/idbadge', locals: {:result => @result, :props => { :full => false} } %>
  </div>

  <% scopecontent_note = @result.note('scopecontent') %>
  <% if scopecontent_note %>
    <%= render partial: 'shared/single_note', locals: {:type => 'abstract', :note_struct => scopecontent_note, :notitle => true} %>
  <% end %>

  <dl class="dl-horizontal">

    <% ['physloc',
        'langmaterial',
        'physdesc',
        'accessrestrict',
        'userestrict',
        'acqinfo',
        'arrangement',
        'originalsloc',
        'relatedmaterial',
       ].each do |note_type| %>
      <% the_note = @result.note(note_type) %>
      <% if the_note && !the_note['note_text'].blank? %>
        <dt><%= the_note['label'] %></dt>
        <dd>
          <%= render partial: 'shared/single_note', locals: {:type => note_type, :note_struct => the_note, :notitle => true} %>
        </dd>
      <% end %>
    <% end %>

    <% unless @result.dates.blank? %>
        <dt><%= t('resource._public.dates') %></dt>
        <% @result.dates.each do |date| %>
        <dd>
          <%= inheritance(date['_inherited']).html_safe %>
          <%= date['final_expression'] %>
        </dd>
        <% end %>
    <% end %>

    <% unless @result.extents.blank? %>
        <dt><%= t('resource._public.extent') %></dt>
        <% @result.extents.each do |extent| %>
          <dd>
            <%= inheritance(extent['_inherited']).html_safe %>
            <%= extent['display']%>
          </dd>
        <% end %>
    <% end %>

    <% unless @result.agents.blank? %>
      <dt><%= t('pui_agent.related') %></dt>
        <% @result.agents.collect(&:last).flatten.each do |relationship| %>
          <dd>
            <%= link_to relationship.fetch('_resolved').fetch('title'), app_prefix(relationship.fetch('ref')) %>
          </dd>
        <% end %>
    <% end %>

    <% if @result['language'] %>
        <dt><%= t('resource._public.lang')%></dt>
        <dd><%= t('enumerations.language_iso639_2.' + @result['language'].downcase) %></dd>
    <% end %>
  </dl>
</div>